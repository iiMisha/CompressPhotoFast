# Обязательное использование субагентов

## КРИТИЧЕСКИ ВАЖНЫЕ ПРАВИЛА

Эти правила ОБЯЗАТЕЛЬНЫ к выполнению для ВСЕХ задач. Никаких исключений.

---

## Когда и каких субагентов использовать

### 1. Исследование кодовой базы (Explore)

**ОБЯЗАТЕЛЬНО ИСПОЛЬЗОВАТЬ:** `Task(Explore, thoroughness, "запрос")`

**Когда применять:**
- Поиск файлов по паттернам (`src/**/*.kt`, `app/src/**/*Test.kt`)
- Поиск кода по ключевым словам
- Ответы на вопросы о кодовой базе ("как работает X?", "где находится Y?")
- Изучение структуры проекта
- Анализ существующих паттернов реализации

**Уровни детализации (thoroughness):**
- `"quick"` - для быстрых targeted поисков
- `"medium"` - для сбалансированного исследования (по умолчанию)
- `"very thorough"` - для комплексного анализа

**ПРИМЕР:**
```
Task(Explore, "medium", "Найти все файлы связанные с сжатием изображений")
```

**ЗАПРЕЩЕНО:**
- ❌ Использовать Glob/Grep для исследования в основном разговоре
- ❌ Читать множество файлов напрямую в основном разговоре
- ❌ Выполнять многоэтапное исследование без субагента

---

### 2. Kotlin/Android разработка (kotlin-specialist)

**ОБЯЗАТЕЛЬНО ИСПОЛЬЗОВАТЬ:** `Task(voltagent-lang:kotlin-specialist, "задача")`

**Когда применять:**
- Редактирование файлов `.kt`
- Создание новых Kotlin файлов
- Рефакторинг Kotlin кода
- Работа с Android компонентами (Activity, Fragment, ViewModel)
- Использование корутинов, Flow, StateFlow
- Работа с Compose UI

**ПРИМЕР:**
```
Task(voltagent-lang:kotlin-specialist, "Реализовать функцию сжатия изображений с использованием Coil")
```

**ЗАПРЕЩЕНО:**
- ❌ Редактировать .kt файлы напрямую в основном разговоре
- ❌ Создавать Kotlin код без исследования существующих паттернов
- ❌ Использовать Edit/Write для .kt файлов в основном разговоре

---

### 3. Тестирование (kotlin-specialist)

**ОБЯЗАТЕЛЬНО ИСПОЛЬЗОВАТЬ:** `Task(voltagent-lang:kotlin-specialist, "тестовая задача")`

**Когда применять:**
- Написание unit тестов
- Написание instrumentation тестов
- Создание тестовых фикстур
- Mock/MockK настройки
- Espresso тесты

**ПРИМЕР:**
```
Task(voltagent-lang:kotlin-specialist, "Написать unit тесты для ImageCompressor")
```

---

### 4. Инфраструктура и DevOps

**ОБЯЗАТЕЛЬНО ИСПОЛЬЗОВАТЬ:** Соответствующих `voltagent-infra:*` субагентов

**Когда применять:**
- CI/CD настройка (GitHub Actions)
- Docker контейнеры
- Gradle конфигурации
- Деплоймент автоматизация
- Мониторинг и логирование

**Доступные субагенты:**
- `voltagent-infra:devops-engineer` - CI/CD, automation
- `voltagent-infra:deployment-engineer` - Release automation
- `voltagent-infra:platform-engineer` - Developer platforms
- `voltagent-infra:security-engineer` - DevSecOps

**ПРИМЕР:**
```
Task(voltagent-infra:devops-engineer, "Настроить GitHub Actions для CI/CD")
```

---

### 5. Планирование разработки

**ИСПОЛЬЗОВАТЬ:** `Task(Plan, thoroughness, "задача")`

**Когда применять:**
- Анализ требований перед реализацией
- Разработка плана реализации сложной задачи
- Выбор архитектурного подхода

**ПРИМЕР:**
```
Task(Plan, "medium", "План реализации функции пакетной обработки изображений")
```

---

## Обязательный Workflow для разработки

### Шаг 1: Исследование (Всегда первый)

```
Task(Explore, "medium", "Найти существующие реализации [что ищем]")
```

### Шаг 2: Чтение Memory Bank

ПЕРЕД любой разработкой прочитать:
- `.claude/memory-bank/brief.md`
- `.claude/memory-bank/architecture.md`
- `.claude/memory-bank/context.md`
- `.kilocode/rules/rules.md`

### Шаг 3: Реализация

```
Task(voltagent-lang:kotlin-specialist, "Реализовать [функция] на основе найденных паттернов")
```

### Шаг 4: Сборка (Обязательная)

После ЛЮБЫХ изменений кода:
```
./gradlew assembleDebug
```

---

## Что разрешено в основном разговоре

✅ Чтение конкретных файлов (Read tool)
✅ Поиск конкретного файла по имени (Glob tool)
✅ Поиск в 2-3 конкретных файлах (Read tool)
✅ Ответы на вопросы о процессе
✅ Управление todo списками
✅ Запуск субагентов

## Что запрещено в основном разговоре

❌ Редактирование Kotlin файлов (Edit/Write) → используйте `Task(voltagent-lang:kotlin-specialist)`
❌ Исследование кодовой базы → используйте `Task(Explore)`
❌ Создание нового кода → используйте соответствующего специализированного агента
❌ Написание тестов → используйте `Task(voltagent-lang:kotlin-specialist)`

---

## Принципы

1. **Сохраняй контекст** - Исследование в субагентах сохраняет контекст основного разговора
2. **Специализация** - Используй специализированных агентов для конкретных технологий
3. **Параллельность** - Запускай несколько агентов параллельно в одном сообщении
4. **Последовательность** - Сначала исследуй (Explore), потом реализуй (specialist)

---

## Проверка compliance

Перед выполнением ЛЮБОЙ задачи задай себе вопрос:

**"Требуется ли для этой задачи субагент?"**

- Если ДА → используй Task tool
- Если НЕТ → можешь выполнить в основном разговоре

---

**ЭТИ ПРАВИЛА НЕОБХОДИМО СЛЕДОВАТЬ ВСЕГДА. БЕЗ ИСКЛЮЧЕНИЙ.**
