# Правила разработки CompressPhotoFast

**Язык:** Русский | **ОС:** Linux Mint

---

## КРИТИЧЕСКИ ВАЖНЫЕ ПРАВИЛА (Обязательны к выполнению)

```
1. ЧИТАТЬ Memory Bank в НАЧАЛЕ КАЖДОЙ задачи
2. ИСПОЛЬЗОВАТЬ Агенты/Скиллы для ВСЕХ изменений кода
3. ВЫПОЛНЯТЬ ./gradlew assembleDebug после КАЖДОГО изменения кода
4. ИСПОЛЬЗОВАТЬ /test-runner для ВСЕХ запусков тестов
```

**Нарушение этих правил приведёт к неправильной работе.**

---

## 1. Memory Bank - ОБЯЗАТЕЛЬНО

### ВЫПОЛНИ:
```
В НАЧАЛЕ КАЖДОЙ задачи:
1. ПРОЧИТАЙ .claude/memory-bank/brief.md
2. ПРОЧИТАЙ .claude/memory-bank/product.md
3. ПРОЧИТАЙ .claude/memory-bank/context.md     ← КРИТИЧНО!
4. ПРОЧИТАЙ .claude/memory-bank/architecture.md
5. ПРОЧИТАЙ .claude/memory-bank/tech.md
6. ПРОЧИТАЙ .claude/memory-bank/tasks.md
```

### ПОСЛЕ ЧТЕНИЯ:
ОБЯЗАТЕЛЬНО укажи в ответе: `[Memory Bank: Active]`

### ИСКЛЮЧЕНИЙ НЕТ:
Даже если ты "помнишь" проект - контекст мог измениться.

---

## 2. Рабочий процесс - СТРОГАЯ ПОСЛЕДОВАТЕЛЬНОСТЬ

```
Memory Bank → Агент/Скилл → Сборка → ... → Тесты (ТОЛЬКО В КОНЦЕ)
```

### 2.1 Сборка - ОБЯЗАТЕЛЬНО ПОСЛЕ КАЖДОГО ИЗМЕНЕНИЯ КОДА

```bash
./gradlew assembleDebug
```

- ОБЯЗАТЕЛЬНО выполнять после КАЖДОГО изменения кода
- ИСКЛЮЧЕНИЙ НЕТ
- Если сборка упала - исправь ошибки перед продолжением

### 2.2 Тестирование - ТОЛЬКО ЧЕРЕЗ СКИЛЛЫ

**НАПИСАНИЕ тестов:**
- Используй агент `voltagent-lang:kotlin-specialist`

**ЗАПУСК тестов:**
- Используй скилл `/test-runner` для unit тестов
- Используй скилл `/android-test-suite` для полного тестирования
- НИКОГДА не запускай тесты напрямую через Bash

| Тип тестов | Скилл | Время |
|-----------|-------|------|
| Unit | `/test-runner` | ~10м |
| Полные | `/android-test-suite` | ~20м |

**Примечание:** Instrumentation тесты требуют эмулятор `Small_Phone`.

---

## 3. Агенты - ОБЯЗАТЕЛЬНО ДЛЯ ЗАДАЧ С КОДОМ

### ДЕРЕВО РЕШЕНИЙ:
```
Задача связана с кодом?
├─ ДА → Есть специализированный агент?
│   ├─ ДА → ИСПОЛЬЗУЙ АГЕНТА
│   └─ НЕТ → Используй агент general-purpose
└─ НЕТ → Можно сделать вручную?
    ├─ ДА → Сделай сам (Read, Glob, Grep)
    └─ НЕТ → Используй агент general-purpose
```

### ОБЯЗАТЕЛЬНОЕ ИСПОЛЬЗОВАНИЕ АГЕНТОВ:

| Тип задачи | Агент | Обязателен? |
|-----------|-------|-------------|
| Написание Kotlin/Android кода | `voltagent-lang:kotlin-specialist` | ✅ ДА |
| Рефакторинг кода | `voltagent-lang:kotlin-specialist` | ✅ ДА |
| Написание тестов | `voltagent-lang:kotlin-specialist` | ✅ ДА |
| Исследование кодовой базы | `Explore` | ✅ ДА |
| Планирование архитектуры | `Plan` | ✅ ДА |
| CI/CD, Gradle, GitHub Actions | `voltagent-infra:devops-engineer` | ✅ ДА |
| База данных (Room/SQLite) | `voltagent-infra:database-administrator` | ✅ ДА |

### ОБЯЗАТЕЛЬНО ИСПОЛЬЗУЙ АГЕНТА ДЛЯ:
- ✅ Изменений 2+ файлов
- ✅ Реализации нового функционала
- ✅ Рефакторинга существующего кода
- ✅ Написания или изменения тестов
- ✅ Анализа архитектуры
- ✅ Исследования кодовой базы
- ✅ Настройки CI/CD
- ✅ Операций с базой данных

### НЕ ИСПОЛЬЗУЙ АГЕНТА ДЛЯ:
- ❌ Чтения 1 файла → Используй `Read`
- ❌ Поиска файла по точному имени → Используй `Glob`
- ❌ Поиска в 1-2 файлах → Используй `Read`/`Grep`
- ❌ Однострочных исправлений (опечатки, импорты)

### ПРИ СОМНЕНИЯХ:
**ИСПОЛЬЗУЙ АГЕНТА.** Лучше делегировать, чем сделать плохо.

### ПАРАЛЛЕЛЬНОЕ ВЫПОЛНЕНИЕ:
✅ Запускай нескольких агентов параллельно, когда задачи независимы

---

## 4. Локальные агенты - Справочник

**Расположение:** `.claude/agents/`

**Языковые агенты:**
```
kotlin-specialist     → Kotlin/Android (Compose, Coroutines, KMP, Room)
java-architect        → Java + Android SDK архитектура
```

**Инфраструктурные агенты:**
```
deployment-engineer       → CI/CD, Gradle, GitHub Actions
devops-engineer           → Автоматизация
platform-engineer         → Инструменты разработки
database-administrator    → Room DB, SQLite
```

**Вызов:** Используй глобальные префиксы `voltagent-lang:`, `voltagent-infra:`

---

## 5. Скиллы - ОБЯЗАТЕЛЬНО ДЛЯ СПЕЦИФИЧЕСКИХ ЗАДАЧ

### ПРАВИЛО:
Скиллы - это ПЕРВИЧНЫЙ способ выполнения специфических задач. НЕ дублируй их вручную.

### ОБЯЗАТЕЛЬНОЕ ИСПОЛЬЗОВАНИЕ СКИЛЛОВ:

| Скилл | Когда использовать (ОБЯЗАТЕЛЬНО) |
|-------|--------------------------------|
| `/memory-bank-updater` | Начало НОВОЙ задачи, конец задачи, изменение архитектуры |
| `/test-runner` | Запуск тестов - ВСЕГДА через скилл, НЕ напрямую через Bash |
| `/android-test-suite` | Полное тестирование (unit + instrumentation + E2E + performance) |
| `/android-optimization-analyzer` | Перед оптимизацией производительности или анализом проблем |
| `/lint-check` | Перед коммитом в main, review кода, поиск ошибок |

### ЗАПРЕЩЕНО:
```
❌ Запуск тестов через Bash напрямую → Используй /test-runner
❌ Написание ручных скриптов для тестов → Используй скиллы
❌ Пропуск lint проверки перед значительными изменениями
❌ Забывание обновить Memory Bank после завершения задачи
```

### ОБЯЗАТЕЛЬНЫЙ РАБОЧИЙ ПРОЦЕСС:
```
1. Начало задачи  → /memory-bank-updater (обновить context/tasks)
2. Написание кода → voltagent-lang:kotlin-specialist
3. Перед коммитом → /lint-check
4. Запуск тестов  → /test-runner
5. Конец задачи    → /memory-bank-updater (документировать результаты)
```

---

## 6. Руководство по использованию инструментов

### ПРЕДПОЧИТАЙ СПЕЦИАЛИЗИРОВАННЫЕ ИНСТРУМЕНТЫ:
- Файловые операции → `Read`, `Write`, `Edit` (НЕ bash echo/cat)
- Поиск файлов → `Glob` (НЕ bash find)
- Поиск содержимого → `Grep` (НЕ bash grep)
- Git операции → Инструмент `Bash`

### НИКОГДА НЕ ИСПОЛЬЗУЙ:
- ❌ `find`, `grep`, `cat`, `head`, `tail`, `sed`, `awk` через Bash
- ❌ `echo` для коммуникации - выводи текст напрямую

---

## 7. Быстрая шпаргалка

```bash
# Memory Bank
ПРОЧИТАЙ: .claude/memory-bank/*.md
Статус: [Memory Bank: Active]

# Сборка
./gradlew assembleDebug

# Тесты
Скилл: /test-runner (unit)
Скилл: /android-test-suite (полные)

# Качество кода
Скилл: /lint-check

# Документация
Скилл: /memory-bank-updater
```

---

## КОНТРОЛЬ СОБЛЮДЕНИЯ ПРАВИЛ

Эти правила **СТРОГО ОБЯЗАТЕЛЬНЫ**.

Нарушение приведёт к:
- Неправильному коду
- Падающим сборкам
- Сломанным тестам
- Потере работы

**При сомнениях: ПЕРЕЧИТАЙ ПРАВИЛА.**
