# Workflow: Исследование кодовой базы

## Назначение

Это правило определяет, как проводить исследование кодовой базы проекта CompressPhotoFast.

---

## Обязательное правило

**ВСЕ исследования кодовой базы ДОЛЖНЫ выполняться через субагент Explore.**

---

## Когда использовать исследования

Используй `Task(Explore)` в следующих случаях:

### 1. Поиск файлов по паттернам
- Найти все Kotlin файлы в модуле
- Найти тестовые файлы
- Найти файлы ресурсов
- Найти файлы конфигурации

**ПРИМЕРЫ:**
```
Task(Explore, "medium", "Найти все файлы ViewModel в проекте")
Task(Explore, "quick", "Найти все тестовые файлы для compression модуля")
```

### 2. Поиск кода по ключевым словам
- Найти использование конкретного API
- Найти реализации интерфейса
- Найти обработчики ошибок
- Найти конфигурации

**ПРИМЕРЫ:**
```
Task(Explore, "medium", "Найти где используется ImageDecoder")
Task(Explore, "very thorough", "Найти все реализации Compressor interface")
```

### 3. Понимание архитектуры
- Как работает конкретная подсистема
- Где находится бизнес-логика
- Как компоненты взаимодействуют
- Какие паттерны используются

**ПРИМЕРЫ:**
```
Task(Explore, "medium", "Как работает система сжатия изображений?")
Task(Explore, "very thorough", "Объясни архитектуру приложения CompressPhotoFast")
```

### 4. Анализ существующих паттернов
- Какие паттерны используются в коде
- Как структурированы ViewModels
- Как организован репозиторий
- Как работает dependency injection

**ПРИМЕРЫ:**
```
Task(Explore, "medium", "Найти паттерны реализации ViewModels в проекте")
Task(Explore, "medium", "Как организован доступ к данным в приложении?")
```

### 5. Подготовка к реализации
Перед написанием нового кода ВСЕГДА исследуй существующие реализации:
```
Task(Explore, "medium", "Найти существующие реализации compressors для понимания паттернов")
```

---

## Уровни детализации (Thoroughness)

### `"quick"` - Быстрый поиск
Используй для:
- Targeted поиска конкретного файла/класса
- Поиска конкретного использования API
- Быстрых справок

**Примеры вопросов:**
- "Где находится MainActivity?"
- "Какой файл содержит Compressor interface?"
- "Где настраивается Coil?"

### `"medium"` - Сбалансированное исследование (по умолчанию)
Используй для:
- Понимания подсистемы
- Поиска паттернов реализации
- Подготовки к разработке

**Примеры вопросов:**
- "Как работает система сжатия?"
- "Найти все ViewModels в проекте"
- "Как организована работа с изображениями?"

### `"very thorough"` - Комплексный анализ
Используй для:
- Глубокого понимания архитектуры
- Анализа больших подсистем
- Рефакторинга

**Примеры вопросов:**
- "Проанализировать всю архитектуру приложения"
- "Найти все места для оптимизации производительности"
- "Полностью изучить систему навигации"

---

## Формат запроса к Explore

### Базовый формат
```
Task(Explore, "thoroughness", "что найти/изучить")
```

### Расширенный формат с контекстом
```
Task(Explore, "medium", "
Найти существующие реализации [компонент] для понимания:
1. Какие паттерны используются
2. Как структурирован код
3. Какие зависимости используются
4. Какие best practices применяются

Это нужно для реализации [новая функция] в том же стиле.
")
```

---

## После исследования

После получения результатов от Explore субагента:

1. **Проанализируй результаты** - изучи найденные паттерны
2. **Обсуди с пользователем** - предложи подход на основе найденного
3. **Используй результаты** - передай их в specialized агент для реализации

**Пример полного workflow:**

```
// Шаг 1: Исследование
Task(Explore, "medium", "Найти существующие реализации Compressor interface")

// Шаг 2: Реализация (с использованием результатов)
Task(voltagent-lang:kotlin-specialist, "
Реализовать новый JpegCompressor следуя паттернам:
- Использовать ту же структуру что и существующие компрессоры
- Применить те же зависимости и библиотеки
- Следовать тем же соглашениям об именовании
")
```

---

## Что НЕЛЬЗЯ делать

❌ **НЕ используй Glob/Grep для исследований** в основном разговоре
- Glob/Grep только для конкретного известного файла
- Для исследований → `Task(Explore)`

❌ **НЕ читай множество файлов** в основном разговоре
- Это перегружает контекст
- Используй `Task(Explore)` вместо этого

❌ **НЕ делай многошаговый поиск** в основном разговоре
- Вместо серии Glob → Grep → Read
- Используй один вызов `Task(Explore)`

---

## Примеры правильного использования

### ✅ Правильно: Использование Explore
```
User: "Где находятся все ViewModel?"

Assistant: Я использую Explore для поиска всех ViewModel:
Task(Explore, "medium", "Найти все ViewModel классы в проекте")
```

### ❌ Неправильно: Прямой поиск
```
User: "Где находятся все ViewModel?"

Assistant: Я поищу файлы... [Glob, Grep, Read много раз]
```

---

## Интеграция с другими workflow

### Перед реализацией
1. `Task(Explore, "medium", "Найти паттерны")`
2. Прочитать Memory Bank файлы
3. `Task(voltagent-lang:kotlin-specialist, "Реализовать используя паттерны")`

### Перед рефакторингом
1. `Task(Explore, "very thorough", "Проанализировать всю систему")`
2. `Task(Plan, "medium", "План рефакторинга")`
3. `Task(voltagent-lang:kotlin-specialist, "Выполнить рефакторинг")`

### Для написания тестов
1. `Task(Explore, "medium", "Найти существующие тесты для паттернов")`
2. `Task(voltagent-lang:kotlin-specialist, "Написать тесты следуя паттернам")`

---

## Чек-лист для исследования

Перед тем как выполнить исследование, убедись:

- [ ] Используется `Task(Explore)` а не прямые Glob/Grep/Read
- [ ] Указан уровень детализации (thoroughness)
- [ ] Запрос сформулирован четко
- [ ] Понимна цель исследования
- [ ] Результаты будут использованы для дальнейшей работы

---

**ЭТОТ WORKFLOW ОБЯЗАТЕЛЕН ДЛЯ ВСЕХ ИССЛЕДОВАНИЙ КОДОВОЙ БАЗЫ.**
