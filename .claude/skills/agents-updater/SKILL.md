---
name: agents-updater
description: Управляет AGENTS.md проекта - инициализация, обновление и документирование задач
user-invocable: true
arguments:
  - name: operation
    description: Тип операции (initialize, update, add_task)
    required: true
  - name: focus_source
    description: Конкретный файл или папка для фокуса при обновлении (опционально)
    required: false
  - name: task_context
    description: Контекст задачи для документирования (для add_task)
    required: false
---

# AGENTS.md Updater

Этот скилл управляет AGENTS.md проекта CompressPhotoFast - системой документации для сохранения контекста между сессиями работы.

## ⚠️ КРИТИЧЕСКОЕ ОГРАНИЧЕНИЕ

**Скилл МОЖЕТ изменять ТОЛЬКО файл `AGENTS.md` в корне проекта**

**ЗАПРЕЩЕНО:**
- ❌ Использовать `Write` или `Edit` для любых файлов кроме `AGENTS.md`
- ❌ Создавать новые файлы кроме `AGENTS.md`
- ❌ Изменять `.claude/rules/` или любые другие файлы настроек
- ❌ Изменять код приложения (`.kt`, `.xml`, `.gradle.kts` и др.)
- ❌ Выполнять `git commit` или любые git операции

**РАЗРЕШЕНО:**
- ✅ `Read` для чтения файлов проекта (для сбора информации)
- ✅ `Glob` и `Grep` для поиска файлов и кода
- ✅ `Bash` только для `git log` (чтение истории изменений)
- ✅ `Write` и `Edit` ТОЛЬКО для `AGENTS.md`

---

## Операции скилла

### 1. Initialize (`initialize AGENTS.md`)
Полная инициализация AGENTS.md через комплексный анализ проекта.

**⚠️ ЗАПОМНИ: МОЖНО изменять только `AGENTS.md` в корне проекта**

**ВАЖНО:** Используй ПРЯМЫЕ ИНСТРУМЕНТЫ для анализа проекта вместо агента Explore (вызывает переполнение памяти):

**ШАГ 1: Собери информацию через Glob/Grep:**
```bash
# Найти основные исходные файлы
Glob("**/*.kt")  # все Kotlin файлы
Glob("**/build.gradle.kts")  # build конфигурации
Glob("**/AndroidManifest.xml")  # манифесты

# Найти ключевые компоненты через Grep
Grep("class.*ViewModel", "**/*.kt")  # ViewModels
Grep("interface Compressor", "**/*.kt")  # Компрессоры
Grep("@Module|@InstallIn", "**/*.kt")  # DI модули
```

**ШАГ 2: Прочитай ключевые файлы через Read:**
- `app/src/main/AndroidManifest.xml`
- `app/build.gradle.kts`
- `build.gradle.kts`
- `README.md` (если есть)

**ШАГ 3: На основе собранной информации создай `AGENTS.md`**

**⚠️ ВСЕГДА придерживайся компактного формата:**
- Максимально краткие описания (1-2 предложения)
- Только ключевая информация без деталей
- ✅ Списки вместо таблиц
- ✅ Одно предложение вместо абзаца
- ❌ Без примеров кода
- ❌ Без подробных объяснений

### 2. Update (`update AGENTS.md`)
Обновление AGENTS.md после изменений. Можно указать `focus_source` для фокуса на конкретной части.

**⚠️ ЗАПОМНИ: МОЖНО изменять только `AGENTS.md`**

**ВАЖНО:** Используй ПРЯМЫЕ ИНСТРУМЕНТЫ вместо Explore:

**Если указан `focus_source`:**
- Используй `Read` для конкретного файла

**Если `focus_source` НЕ указан:**
```bash
# Проверь git log для недавних изменений
Bash("git log --oneline -10 --name-only")

# Или найди недавние файлы через Glob
Glob("app/src/main/**/*.kt")
Glob("**/build.gradle.kts")
```

**КРИТИЧЕСКИ:**
- ❌ НЕ используй `Task(Explore)` - вызывает переполнение памяти
- ✅ Используй Bash + git log для недавних изменений
- ✅ Используй Glob для поиска файлов
- ✅ Используй Read для чтения конкретных файлов

**⚠️ КРИТИЧЕСКИ ВАЖНО: Контроль размера AGENTS.md**

После ЛЮБОГО обновления AGENTS.md ВСЕГДА выполняй следующие шаги:

1. **Проверь размер файла** - если больше 200 строк, сократи:
   - Удали самые старые изменения из секции "Current Focus"
   - Оставь только последние 5-7 изменений
   - Сократи описания до essentials
   - Используй краткие формулировки

2. **Формат для компактности:**
   - Используй списки вместо таблиц
   - Одно предложение вместо абзаца
   - Только ключевые факты (без объяснений "почему")
   - Ссылки на внешнюю документацию вместо дублирования

### 3. Add Task (`add task` / `store this as a task`)
Документирование повторяющейся задачи в секцию "Development Workflows" AGENTS.md.

**⚠️ ЗАПОМНИ: МОЖНО изменять только `AGENTS.md`**

**⚠️ Правила компактности для задач:**
- **Макс 15 строк на задачу** (краткое описание + шаги)
- Только essentials: когда, какие файлы, 3-7 шагов
- ❌ Без примеров кода (только ссылки на файлы)
- ❌ Без подробных объяснений
- ❌ Без дублирования из документации
- Используй краткие формулировки: "Запустить тесты" вместо "Для того чтобы запустить тесты необходимо выполнить следующую команду..."

**Формат задачи:**
```markdown
### Краткое название задачи

**Когда**: [когда требуется]
**Файлы**: [список файлов через запятую]

**Шаги:**
1. [Действие]
2. [Действие]
3. [Действие]

**Важно**: [1-2 критичных замечания]
```

После добавления задачи ПРОВЕРЬ размер `AGENTS.md` - если больше 200 строк, удали неактуальные задачи.

---

## Расположение

AGENTS.md находится в корне проекта.

## Связанные файлы

- `.claude/rules/agents-instructions.md` - Полная документация AGENTS.md

## Автоматизация через инструменты

### КРИТИЧЕСКОЕ ПРАВИЛО
**Скилл использует ТОЛЬКО прямые инструменты (Glob/Grep/Read). Агенты НЕ используются.**

### Почему НЕ используются агенты?

1. **Task(Explore)** вызывает переполнение памяти при анализе проекта
2. **Анализ проекта** может быть эффективно выполнен через Glob/Grep
3. **Обновление документации** не требует специализированных знаний

### Используемые инструменты

**Glob** - поиск файлов по паттерну:
```bash
Glob("**/*.kt")           # Все Kotlin файлы
Glob("**/build.gradle.kts")  # Gradle конфигурации
```

**Grep** - поиск кода по ключевым словам:
```bash
Grep("class.*ViewModel", "**/*.kt")  # ViewModels
Grep("@Module|@InstallIn", "**/*.kt")  # DI модули
```

**Read** - чтение конкретных файлов:
```bash
Read("app/src/main/AndroidManifest.xml")
Read("app/build.gradle.kts")
```

**Bash** - ТОЛЬКО для git log (read-only):
```bash
Bash("git log --oneline -10 --name-only")
```

### Запрещено

- ❌ Использовать Task tool для вызова агентов
- ❌ Использовать Task(Explore) для анализа проекта
- ❌ Пытаться прочитать все файлы одновременно (читай только ключевые)
