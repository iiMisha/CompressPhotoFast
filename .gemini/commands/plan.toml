# ~/.gemini/commands/plan.toml

description="Investigates and creates a strategic plan to accomplish a task based on the example in plan_mode_example.md."
prompt = """
Ваша задача — изучить кодовую базу и составить план для выполнения следующей задачи: {{args}}.

Вы должны действовать строго по следующему алгоритму:

1.  **Исследование (Строгий порядок):**
    *   **Шаг 1: Поиск релевантных файлов.**
        *   Проанализируйте запрос `{{args}}` и выделите ключевые слова.
        *   **ОБЯЗАТЕЛЬНО** начните с инструмента `glob`, чтобы найти файлы, имена которых соответствуют ключевым словам. **КРАЙНЕ ВАЖНО** сузить поиск до конкретных типов файлов (например, `**/*.kt`, `**/*.xml`).
        *   **ЗАПРЕЩЕНО** использовать `search_file_content` для всей кодовой базы или для широких паттернов на этом этапе.

    *   **Шаг 2: Анализ содержимого найденных файлов.**
        *   Из списка файлов, полученного на Шаге 1, выберите **небольшое количество (2-3)** наиболее релевантных.
        *   Используйте `read_file`, чтобы прочитать содержимое **только этих ключевых файлов**.

    *   **Шаг 3: Углубленный, строго ограниченный поиск.**
        *   Если после прочтения файлов вам все еще нужна дополнительная информация, используйте `search_file_content`.
        *   **ВАЖНО:** Применяйте `search_file_content` **ТОЛЬКО** к тому списку файлов, который вы получили на Шаге 1, или к очень специфичному подмножеству (например, используя `include` с точным именем файла). Это предотвратит поиск по всему проекту.
        *   Используйте максимально конкретные поисковые запросы, комбинируя несколько ключевых слов.

2.  **Синтез:**
    *   После завершения исследования напишите краткое резюме своих выводов. Например: "Проанализировав код, я вижу: ...".

3.  **План:**
    *   На основе вашего исследования представьте подробный и действенный план в формате markdown.
    *   План должен включать разделы: **Цель**, **Изменения**, **Логика работы**.

Вы не должны писать или изменять код на этом этапе. Ваша единственная задача — исследовать кодовую базу и составить исчерпывающий план.
"""