# Контекст

## Последние изменения

*   **Обновление Memory Bank (17.01.2026)**: Полное обновление документации проекта с учетом текущего состояния.
*   **Система тестирования**: Добавлена локальная система автоматического тестирования для Android-приложения с JaCoCo coverage.
*   **Скрипты установки CLI**: Добавлены автоматические установщики для Linux/macOS (`install.sh`) и Windows (`install.ps1`) с детекцией Python и зависимостей.
*   **Скрипты тестирования**: Добавлены скрипты для запуска unit тестов (`run_unit_tests.sh`) и всех тестов (`run_all_tests.sh`).
*   **Документация**: Добавлен файл [`docs/TESTING.md`](docs/TESTING.md) с описанием системы тестирования.
*   **Проблема двойных расширений**: Выявлена и документирована проблема с созданием файлов с двойными расширениями (например, `image.HEIC.jpg`).
*   **Тестирование HEIC форматов**: Созданы специальные тесты для проверки обработки HEIC/HEIF форматов.
*   **Расширенная система тестирования**: Внедрена многоуровневая система тестирования с unit, instrumentation и интеграционными тестами.

## Текущее состояние проекта

### Android-версия
*   Версия: 2.2.8 (31.08.2025), versionCode 2
*   Kotlin: 2.2.10, Android Gradle Plugin: 8.13.2
*   Использует DataStore для хранения настроек (вместо SharedPreferences)
*   Поддерживает автоматическое сжатие в фоновом режиме
*   Включает функции игнорирования фото из мессенджеров и скриншотов
*   Система тестирования с JaCoCo coverage (текущий ~8-10%, целевой 50-70%)
*   Полный набор утилит в пакете `util` (24 файла)
*   **Статистика тестирования (январь 2026)**:
    *   Всего unit тестов: 251
    *   Проходят успешно: 238 (94.8%)
    *   Instrumentation тестов: 96
    *   Всего тестов: 347 (251 unit + 96 instrumentation)
    *   Общее покрытие: ~8-10%

### CLI-версия
*   Версия: 1.0.0
*   Python: 3.10+
*   Полностью поддерживает многопроцессорную обработку изображений с использованием ProcessPoolExecutor
*   Использует multiprocessing.Manager().Lock() для process-safe доступа к статистике
*   Поддерживает HEIC/HEIF форматы (опционально через pillow-heif)
*   Имеет dry-run режим для предварительного анализа с многопроцессорной обработкой
*   Автоматические установщики для Linux/macOS и Windows
*   Модульная структура с 7 основными файлами

## Дальнейшие шаги

*   Увеличить coverage тестов до 50-70%
*   Добавить instrumentation тесты для оставшихся компонентов
*   Исправить проблему двойных расширений файлов
*   Документировать повторяющиеся задачи в tasks.md