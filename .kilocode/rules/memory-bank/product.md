# Описание продукта: CompressPhotoFast

## Проблема

Пользователи Android часто сталкиваются с необходимостью уменьшить размер фотографий для экономии места на устройстве, ускорения загрузки в интернет или отправки по почте и в мессенджерах. Стандартные инструменты не всегда удобны и эффективны.

## Решение

CompressPhotoFast — это Android-приложение, которое предоставляет простой и быстрый способ сжатия изображений. Приложение предлагает как ручное, так и автоматическое сжатие, а также гибкие настройки качества и режима сохранения.

## Основные функции

*   **Ручное сжатие**: Пользователь может выбрать одно или несколько изображений и сжать их с заданными настройками.
*   **Автоматическое сжатие**: Приложение может работать в фоновом режиме, автоматически обнаруживая и сжимая новые фотографии. При включении этой функции приложение также может обработать ранее пропущенные изображения.
*   **Настройки качества**: Пользователь может выбрать один из трех уровней сжатия: низкий, средний или высокий.
*   **Режимы сохранения**:
    *   **Замена**: Сжатый файл заменяет оригинальный.
    *   **Сохранение в отдельную папку**: Оригинальный файл остается нетронутым, а сжатая копия сохраняется в папке `CompressPhotoFast`.
*   **Обработка через "Поделиться"**: Приложение может получать изображения из других приложений (например, галереи) через меню "Поделиться".
*   **Сохранение EXIF-данных**: Приложение старается сохранить метаданные при сжатии. Для сохранения GPS-координат требуется отдельное разрешение.
*   **Игнорирование фото из мессенджеров**: Возможность исключить из обработки изображения, находящиеся в папках популярных мессенджеров.
*   **Пакетная обработка**: При обработке нескольких изображений отображается итоговая сводка о количестве успешно сжатых, пропущенных и уже оптимизированных файлов.

## Кроссплатформенная CLI-версия

CompressPhotoFast также доступен как CLI-инструмент для Linux и Windows с идентичной логикой сжатия.

### Основные функции CLI

*   **Многопроцессорная обработка**: Использование ProcessPoolExecutor для параллельной обработки изображений с автоматическим определением количества процессов на основе CPU ядер
*   **Process-safe статистика**: Безопасный сбор статистики сжатия из нескольких процессов с использованием multiprocessing.Manager().Lock()
*   **Массовая обработка папок**: Рекурсивное сжатие целых папок с поддержкой подпапок
*   **CLI-интерфейс**: Команды `compress`, `stats`, `version` с богатым набором опций
*   **EXIF-маркеры**: Те же маркеры сжатия для отслеживания обработанных файлов между платформами
*   **Сохранение дат**: Оригинальные даты изменения файлов сохраняются
*   **Два режима**: Замена оригиналов или сохранение в подпапку `CompressPhotoFast/`
*   **Умная фильтрация**: Пропуск скриншотов и фотографий из мессенджеров
*   **Dry-run режим**: Предварительный просмотр сжатия без фактической обработки с многопроцессорной анализом
*   **Поддержка HEIC/HEIF**: Конвертация HEIC/HEIF файлов в JPEG при сжатии (требует pillow-heif)
*   **Идентичные правила сжатия**:
    *   Минимальный размер файла: 100 КБ
    *   Минимальная экономия: 30% + 10 КБ
    *   Маркер: `CompressPhotoFast_Compressed:quality:timestamp`
    *   Уровни качества: Low (60), Medium (70), High (85)

### Поддерживаемые платформы

*   **Linux**: Полная поддержка через Python-скрипты
*   **Windows**: Полная поддержка через batch-скрипты
*   **macOS**: Теоретически поддерживается (не протестировано)

### Автоматическая установка

CLI-версия включает автоматические установщики для упрощения процесса установки:

*   **Linux/macOS**: Скрипт `install/install.sh` автоматически:
    *   Проверяет наличие Python 3.10+
    *   Устанавливает Python при необходимости
    *   Устанавливает системные зависимости для HEIC поддержки
    *   Создает виртуальное окружение
    *   Устанавливает все зависимости

*   **Windows**: Скрипт `install/install.ps1` автоматически:
    *   Проверяет наличие Python 3.10+
    *   Устанавливает Python через winget или chocolatey при необходимости
    *   Создает виртуальное окружение
    *   Устанавливает все зависимости