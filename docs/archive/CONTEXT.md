# Техническое задание: приложение CompressPhoto

# I. Функциональные требования

## 1. Основные функции
- Автоматическое обнаружение новых фотографий в галерее
- Фоновое сжатие обнаруженных фотографий без участия пользователя
- Автоматическая активация фонового режима при запуске системы
- Прием и сжатие изображений, которыми поделились из других приложений (Share/Intent)
- Настройка уровня сжатия (50-90% качества)
- Сохранение сжатых изображений в галерею

## 2. Сохранение сжатых изображений
- Сохранение исходного имени файла с добавлением суффикса (например, "_compressed")
- Полное сохранение всех метаданных изображения (EXIF, XMP, ICC)
- Сохранение в отдельную директорию для сжатых фотографий
- Использование MediaStore API для корректного добавления в галерею

## 3. Пользовательский интерфейс
- Один экран со всей функциональностью
- Слайдер для настройки уровня сжатия
- Переключатель для включения/выключения автоматического режима (мониторинг и сжатие)

# II. Технические требования

## 4. Работа с разрешениями и интеграция
- Запрос необходимых разрешений для Android 10+
- Использование Scoped Storage и MediaStore API для доступа к галерее
- Реализация Intent-фильтров для приема изображений (ACTION_SEND и ACTION_SEND_MULTIPLE)
- Автоматический запуск сжатия для изображений, полученных из других приложений
- Реализация фонового сервиса для мониторинга и обработки новых фотографий

## 5. Поддержка Android
- Минимальная версия: Android 10 (API 29)
- Целевая версия: Android 14 (API 34)
- Автоматический запуск сервиса фонового мониторинга и сжатия при старте системы

# III. Архитектура и реализация

## 6. Структура проекта

```
app/
├── ui/
│   ├── MainActivity.kt        # Единственный экран приложения
│   └── MainViewModel.kt       # ViewModel для основной логики
├── service/
│   └── PhotoMonitorService.kt # Фоновый сервис для мониторинга новых фотографий
├── util/
│   ├── ImageCompressor.kt     # Утилита для сжатия изображений с сохранением метаданных
│   ├── MediaStoreObserver.kt  # Наблюдатель за новыми фотографиями
│   └── PermissionHelper.kt    # Помощник для работы с разрешениями
├── worker/
│   └── CompressionWorker.kt   # Worker для фоновой обработки изображений
└── data/
    └── SettingsManager.kt     # Простое хранение настроек приложения
```

## 7. Технологический стек

### Основные инструменты:
- Gradle: 8.2.0
- Android Gradle Plugin: 8.2.0
- Kotlin: 1.9.0

### Библиотеки для основной функциональности:
- AndroidX Core KTX, AppCompat, ConstraintLayout
- AndroidX Lifecycle (ViewModel и LiveData или Flow)
- AndroidX WorkManager для планирования фоновых задач
- Foreground Service API для надежной работы в фоне
- BroadcastReceiver для обработки системных событий (загрузка устройства)
- Kotlin Coroutines & Flow для асинхронных операций
- Coil для эффективной загрузки изображений
- Compressor library (id.zelory:compressor:3.0.1) для оптимального сжатия изображений
- ExifInterface для работы с метаданными изображений
- Jetpack DataStore для современного хранения настроек
- FileProvider для безопасного обмена файлами

### Дополнительные библиотеки (опционально):
- Koin или Hilt для внедрения зависимостей
- Timber для улучшенного логирования
- Android Photo Filters для дополнительных опций обработки
- Permissions Dispatcher для упрощения работы с разрешениями

# IV. Процесс разработки

## 8. Тестирование
- Базовое тестирование на нескольких устройствах
- Проверка основной функциональности
- Тестирование автоматического запуска и фоновой работы
- Проверка корректности сохранения метаданных и именования файлов

## 9. Документация
- Базовое документирование кода
- Инструкции по настройке автозапуска на разных устройствах
