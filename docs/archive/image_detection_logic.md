# Логика обнаружения новых изображений

В этом приложении реализована автоматическая обработка новых изображений, используя возможности Android JobScheduler (начиная с Android Nougat, SDK ≥ 24).

## Основные компоненты логики

1. **Настройка JobInfo с триггером на изменение контента**
   - В статическом блоке класса происходит инициализация объекта JobInfo, в котором задается условие триггера:
     - Триггер задается через метод `addTriggerContentUri`, где указан URI `MediaStore.Images.Media.EXTERNAL_CONTENT_URI`.
     - Это означает, что при любом изменении в контент-провайдере изображений (например, при добавлении нового изображения) система уведомляет JobScheduler о необходимости запустить задание.

2. **Запуск задания при изменении контента**
   - Когда происходит изменение по указанному URI, система автоматически вызывает метод `onStartJob` в классе, который расширяет `JobService` (в данном случае `CameraJobService`).
   - Метод `onStartJob` отвечает за обработку события: начинается выполнение логики обработки нового изображения.

3. **Обработка нового изображения**
   - Внутри `onStartJob` могут выполняться дополнительные действия, например:
     - Обращение к базе данных через MediaStore для получения данных о новом изображении.
     - Обработка изображения, например, уменьшение его размера или создание миниатюры.
     - Инкрементирование счётчика новых изображений, который сохраняется в `SharedPreferences` (как пример, метод `d(Context)` увеличивает значение "numNewImagesForWeek").

4. **Завершение задания и планирование нового**
   - После завершения обработки вызывается метод, который завершает текущее задание вызовом `jobFinished`.
   - Одновременно происходит повторное планирование задания с помощью вызова `JobScheduler.schedule(...)`, что позволяет оставаться в ожидании будущих изменений без необходимости повторной регистрации.

5. **Обработка событий через BroadcastReceiver**
   - Внутри `CameraJobService` также используется `BroadcastReceiver`, который отслеживает завершение обработки (например, получение intent с действием `REDUCE_FROM_CAMERA_COMPLETE`).
   - При получении корректного события вызывается метод `a()`, который завершает задание и заново планирует его выполнение.

## Преимущества данного подхода

- **Эффективность**: Нет необходимости в постоянном опросе файловой системы; система сама уведомляет приложение о появлении новых изображений.
- **Экономия ресурсов**: Использование JobScheduler позволяет системе масштабировать работу, минимизируя нагрузку на батарею и процессор.
- **Надежность**: Благодаря обработке через системные сервисы, приложение всегда получает уведомление о критически важных изменениях в хранилище изображений.

## Заключение

Использование триггеров на уровне контент-провайдера и JobScheduler обеспечивает эффективное и современное решение для обнаружения изменений в медиа-хранилище. Это решение позволяет своевременно реагировать на появление новых изображений, оптимизируя работу приложения и распределение его ресурсов. 