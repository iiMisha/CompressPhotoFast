# Логика определения сжатых изображений

В данном документе описывается механизм, используемый приложением для отслеживания и определения уже сжатых изображений, чтобы предотвратить их повторную обработку.

## Основные механизмы отслеживания

### 1. Хранение информации о сжатых изображениях

Приложение использует систему хранения пар «ключ-значение» (SharedPreferences) с именем "ReduceActivity" для сохранения информации об обработанных изображениях. В этом хранилище сохраняется набор URI сжатых изображений.

### 2. Маркировка обработанных изображений

**Метаданные:**
При сжатии изображения в его описание добавляется специальная метка (например, "Compressed"), которая свидетельствует о том, что изображение уже было обработано.

## Процесс определения статуса изображения

### 1. Проверка перед сжатием

Перед обработкой нового изображения приложение выполняет следующие проверки:
- Поиск наличия URI изображения в сохранённом наборе обработанных URI.
- Проверка наличия специальной метки в описании изображения.

### 2. Отслеживание состояния обработки

Приложение также сохраняет флаги, отражающие состояние обработки:
- Флаг, указывающий на то, что в данный момент идёт процесс сжатия.
- Флаг, сигнализирующий о завершении сжатия в фоновом режиме.

### 3. Сохранение связей между оригиналами и сжатыми версиями

Для анализа и предотвращения повторного сжатия сохраняется связь между URI оригинальных изображений и URI их сжатых версий.

## Преимущества подхода

1. **Надёжность**
   - Применение нескольких способов определения статуса изображения.
   - Постоянное хранение информации через SharedPreferences.
   - Сохранение специальной метки в метаданных изображения.

2. **Эффективность**
   - Быстрая проверка по URI.
   - Кэширование информации о сжатых изображениях.
   - Минимизация повторных операций.

3. **Отслеживаемость**
   - Сохранение связей между оригиналами и сжатыми версиями позволяет проводить анализ эффективности сжатия.

## Техническая реализация

### Ключевые компоненты

1. **SharedPreferences**
   - Хранение информации о сжатых изображениях и состоянии обработки.

2. **MediaStore**
   - Обновление метаданных изображений, доступ к информации о файлах, сканирование новых файлов.

3. **Файловая система**
   - Организация хранения в отдельной директории, создание временных файлов по необходимости.

### Обработка ошибок

Ошибки логируются с помощью Crashlytics и LogCat, а также сохраняется состояние для восстановления после возникающих ошибок.

## Заключение

Используемый подход обеспечивает надёжное определение статуса обработки изображений посредством комбинации различных методов проверки, что позволяет избежать повторной обработки файлов и поддерживать актуальную информацию о состоянии всех изображений в системе. 